<style>
    .slider.slider-horizontal {
        width: 100%;
    }

    .slider-selection {
        background: pink;
        box-shadow: unset;
    }

    .slider-handle {
        background: lightpink;
        box-shadow: 0 0 5px grey;
    }

    .bs-tooltip-auto[x-placement^=right] .arrow::before,
    .bs-tooltip-right .arrow::before {
        border-right-color: pink;
    }

    .tooltip-inner {
        background-color: pink;
    }

    #output1 {
        text-align: center;
        font-family: monospace;
        font-size: 200%;
        background-color: white;
    }

</style>

<div>
    <div class="row pt-3">
        <h5 class="xt-title">Password Generator</h5>
    </div>

    <form>
        <div class="form-group">
            <label for="range1"></label>
            <input id="range1" type="range" data-slider-min="6" data-slider-max="64" data-slider-step="1" data-slider-value="8" />

            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check1" checked>
                <label class="custom-control-label pr-2" for="check1" data-toggle="tooltip" title="e.g. 123456">Include Numbers</label>
            </div>
            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check2" checked>
                <label class="custom-control-label pr-2" for="check2" data-toggle="tooltip" title="e.g. abcdefgh">Include Lowercase Characters</label>
            </div>
            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check3" checked>
                <label class="custom-control-label pr-2" for="check3" data-toggle="tooltip" title="e.g. ABCDEFGH">Include Uppercase Characters</label>
            </div>
            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check4">
                <label class="custom-control-label pr-2" for="check4" data-toggle="tooltip" title="e.g. @#$%">Include Symbols</label>
            </div>
            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check5">
                <label class="custom-control-label pr-2" for="check5" data-toggle="tooltip" title="Make it easy to enter on phones">Make it easy to enter</label>
            </div>
            <div class="custom-control custom-checkbox mt-2">
                <input type="checkbox" class="custom-control-input option-checkbox" id="check6" checked>
                <label class="custom-control-label pr-2" for="check6" data-toggle="tooltip" title="save all the settings above for later use">Save My Preference</label>
            </div>
        </div>

        <div class="form-group">
            <input type="text" class="form-control" id="output1" readonly></input>
        </div>

        <button type="button" class="btn btn-primary" id="refresh-button">Refresh</button>
        <button type="button" class="btn btn-primary d-none" id="copy-button">Copy</button>
    </form>
</div>

<script>
    "use strict"

    window.partObject = (function() {
        const allNumbers = "0123456789".split("")
        const allLowerAlpha = "abcdefghijklmnopqrstuvwxyz".split("")
        const allCapsAlpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")
        const allUniqueChars = "~!@#$%^&*()_+-=[]\\{}|;:'\",./<>?".split("")

        let _obj = {}

        return {
            init: init,
            activate: activate,
            deactivate: deactivate
        }

        function init() {
            if (navigator.clipboard) {
                document.getElementById("copy-button").classList.remove("d-none")
            }

            // NOTE: tooltip not work with bootstrap 4
            // SEE: https://github.com/seiyria/bootstrap-slider/issues/689
            // SEE: https://github.com/seiyria/bootstrap-slider#options
            _obj.slider1 = new Slider("#range1", {
                tooltip: "hide"
            }).on("change", onChangeSlide)

            // update length lable
            updateLengthLabel(_obj.slider1.getValue())

            // initialize tooltips
            $('[data-toggle="tooltip"]').tooltip({
                placement: "right",
                delay: {
                    "show": 500,
                    "hide": 100
                }
            })

            // add event listeners
            document.getElementById("refresh-button").addEventListener("click", onRefresh);
            document.getElementById("copy-button").addEventListener("click", onCopy);

            [].slice.call(document.querySelectorAll(".option-checkbox")).forEach(function(element) {
                element.addEventListener("change", generateNewPassword)
            })
        }

        function activate() {
            generateNewPassword()
        }

        function deactivate() {
            // do nothing
        }

        function onRefresh() {
            generateNewPassword()
        }

        function onCopy() {
            let output = document.getElementById("output1").value

            navigator.clipboard && navigator.clipboard.writeText(output).then(function() {
                xdialog.info("clipboard successfully set")
            }, function() {
                xdialog.warn("clipboard write failed")
            })
        }

        function onChangeSlide(e) {
            updateLengthLabel(e.newValue)
            generateNewPassword()
        }

        function updateLengthLabel(length) {
            document.querySelector('[for="range1"]').textContent = "Password Length: " + length
        }

        function generateNewPassword() {
            let length = _obj.slider1.getValue()
            let includeNumbers = document.getElementById("check1").checked
            let includeLowers = document.getElementById("check2").checked
            let includeUppers = document.getElementById("check3").checked
            let includeSymbols = document.getElementById("check4").checked
            let easyToEnter = document.getElementById("check5").checked

            let base = []
            let result = []

            if (includeNumbers) {
                doInclude(allNumbers)
            }

            if (includeLowers) {
                doInclude(allLowerAlpha)
            }

            if (includeUppers) {
                doInclude(allCapsAlpha)
            }

            if (includeSymbols) {
                doInclude(allUniqueChars)
            }

            result = result.concat(generator(base, length))

            // group / shuffle process
            if (easyToEnter) {
                group(result)
            } else {
                shuffle(result)
            }

            document.getElementById("output1").value = result.join("")

            function doInclude(_base) {
                result = result.concat(generator(_base, 1))
                base = base.concat(_base)
                length -= 1
            }
        }

        // SEE: https://gist.github.com/6174/6062387#gistcomment-2993079
        function generator(base, len) {
            return Array.apply(null, {
                length: len
            }).map(function(i) {
                return base[Math.random() * base.length | 0]
            })
        }

        // SEE: https://medium.com/@nitinpatel_20236/how-to-shuffle-correctly-shuffle-an-array-in-javascript-15ea3f84bfb
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * i)
                const temp = array[i]
                array[i] = array[j]
                array[j] = temp
            }
        }

        function group(array) {
            array.sort(function(a, b) {
                return getGroupId(a) - getGroupId(b)
            })
        }

        function getGroupId(a) {
            if (allLowerAlpha.indexOf(a) >= 0) {
                return 0
            }

            if (allCapsAlpha.indexOf(a) >= 0) {
                return 1
            }

            if (allNumbers.indexOf(a) >= 0) {
                return 2
            }

            if (allUniqueChars.indexOf(a) >= 0) {
                return 3
            }
        }
    })()

</script>
